<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>week6.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-dartdoc,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="data-journalism-in-the-tidyverse"><a name="data-journalism-in-the-tidyverse" href="#data-journalism-in-the-tidyverse"></a>Data journalism in the tidyverse</h1><p>In last week’s class we worked with a relatively small and simple dataset, on disciplinary actions against California doctors, to learn how to <strong>filter</strong>, <strong>sort</strong>, <strong>group</strong>, and <strong>summarize</strong> data.</p><p>Today we will work with the larger data on doctors in California prescribing opioids under Medicare Part D, learn how to <strong>join</strong> data in different data frames, and see how to make some simple charts to help make sense of your data.</p><p>First we will recap filtering, sorting, grouping and summarizing with the opioid prescription data.</p><h3 id="the-data-we-will-use"><a name="the-data-we-will-use" href="#the-data-we-will-use"></a>The data we will use</h3><p>As for last week, <a href="data/week5.zip">here</a>. It contains the following files:</p><ul>
<li><p><code>ca_discipline.csv</code> Disciplinary alerts and actions issued by the Medical Board of California from 2008 to 2017. Processed from downloads available <a href="http://www.mbc.ca.gov/Publications/Disciplinary_Actions/">here</a>. Contains the following variables:</p>
<ul>
<li><code>alert_date</code> Date alert issued.</li><li><code>last_name</code> Last name of doctor/health care provider.</li><li><code>first_name</code> First name of doctor/health care provider.</li><li><code>middle_name</code> Middle/other names.</li><li><code>name_suffix</code> Name suffix (Jr., II etc)</li><li><code>city</code> City of practive location.</li><li><code>state</code> State of practice location.</li><li><code>license</code> California medical license number.</li><li><code>action_type</code> Type of action.</li><li><code>action_date</code> Date of action.</li></ul>
</li></ul><ul>
<li><p><code>ca_medicare_opioids.csv</code> Data on prescriptions of opioid drugs under the Medicare Part D Prescription Drug Program by doctors in California, from 2013 to 2015. Filtered from the national data downloads available <a href="https://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Medicare-Provider-Charge-Data/Part-D-Prescriber.html">here</a>. This is the public release of the data that ProPublica used FOIA to obtain for earlier years for the story we discussed in Week 2. Contains the following variables:</p>
<ul>
<li><code>npi</code> <a href="https://npiregistry.cms.hhs.gov/">National Provider Identifier</a> (NPI) for the doctor/organization making the claim. This is a unique code for each health care provider.</li><li><code>nppes_provider_last_org_name</code> For individual doctors, their last name. For organizations, the organziation name.</li><li><code>nppes_provider_first_name</code> First name for indivisual doctors, blank for organizations.</li><li><code>nppes_provider_city</code> City where the provider is located.</li><li><code>nppes_provider_state</code> State where the provider is located; “CA” for all of these records.</li><li><code>specialty_description</code> Provider’s medical speciality, reported on their medicare claims. For providers that have more than one Medicare specialty code reported on their claims, the code associated with the largest number of services.</li><li><code>description_flag</code> Source of the <code>specialty_description</code>. <ul>
<li><code>S</code> Medicare Specialty Code description.</li><li><code>T</code> Taxonomy Code Classification description.</li></ul>
</li><li><code>drug_name</code> Includes both brand names (drugs that have a trademarked name) and generic names (drugs that do not have a trademarked name).</li><li><code>generic_name</code> The chemical ingredient of a drug rather than the trademarked brand name under which the drug is sold.</li><li><code>bene_count</code> Total number of unique Medicare Part D beneficiaries (i.e. patients) with at least one claim for the drug. Counts fewer than 11 are suppressed and are indicated by a blank.</li><li><code>total_claim_count</code> Number of Medicare Part D claims; includes original prescriptions and refills. If less than 11, counts are not included in the data file.</li><li><code>total_30_day_fill_count</code> Total number of Medicare Part D standardized 30-day fills. The standardized 30-day fill is derived from the number of days supplied on each Part D claim divided by 30.</li><li><code>total_day_supply</code> Total number of days’ supply for this drug.</li><li><code>total_drug_cost</code> Total cost paid for all associated claims; includes ingredient cost, dispensing fee, sales tax, and any applicable fees.</li><li><code>bene_count_ge65</code> Total number of unique Medicare Part D beneficiaries age 65 and older with at least one claim for the drug. A blank indicates the value is suppressed.</li><li><code>bene_count_ge65_suppress_flag</code> Why the <code>bene_count_ge65</code> variable is suppressed:<ul>
<li><code>*</code> Suppressed due to <code>bene_count_ge65</code> between 1 and 10.</li><li><code>#</code> Suppressed because the “less than 65 year old” group (not displayed) contains a beneficiary count between 1 and 10.</li><li><code>total_claim_count_ge65</code> Number of Medicare Part D claims for beneficiaries age 65 and older; includes original prescriptions and refills. A blank indicates the value is suppressed.</li><li><code>ge65_suppress_flag</code> Why the  <code>total_claim_count_ge65</code>, <code>total_30_day_fill_count ge65</code>, <code>total_day_supply_ge65</code>, and <code>total_drug_cost_ge65 variables</code> are suppressed:<ul>
<li><code>*</code> Suppressed due to <code>total_claim_count_ge65</code> between 1 and 10.</li></ul>
</li><li><code>#</code> Suppressed because the “less than 65 year old” group (not displayed)<br>contains a claim count between 1 and 1.</li></ul>
</li><li><code>total_30_day_fill_count_ge65</code> Number of Medicare Part D standardized 30-day fills for beneficiaries age 65 and older. If <code>total_claim_count_ge65</code> is suppressed, this variable is also suppressed.</li><li><code>total_day_supply_ge65</code> Total days’ supply for which this drug was dispensed, for beneficiaries age 65 and older. If <code>total_claim_count_ge65</code> is suppressed, this variable is also suppressed.</li><li><code>total_drug_cost_ge65</code> Total drug cost paid for all associated claims for beneficiaries age 65 and older. If <code>total_claim_count_ge65</code> is suppressed, this is also suppressed.</li><li><code>year</code> 2013, 2014, or 2015.</li></ul>
</li><li><p><code>npi_license.csv</code> Crosswalk file to join NPI identifiers to state license numbers, processed from the download available <a href="http://www.nber.org/data/npi-state-license-crosswalk.html">here</a> to include license numbers potentially matching California doctors. This will provide one way of joining the precription data to the medical board disciplinary data. As we shall see, problems with the data mean that it is not infallible. Contains the following variables:</p>
<ul>
<li><code>npi</code> National Provider Identifier, as described above.</li><li><code>plicnum</code> State license number, from the original file.</li><li><code>license</code> Processed from <code>pclicnum</code> to conform to the format of California medical license numbers.</li></ul>
</li></ul><h3 id="setting-up"><a name="setting-up" href="#setting-up"></a>Setting up</h3><p>Open a new R script, save it into the folder with the data as <code>week6.R</code> then set your working directory to the location of this file, as we did last week. Then save your environment as <code>week6.Rdata</code>.</p><p>Also load the packages we will work with today:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># load packages to read, write and process data, and to work with dates
library(readr)
library(dplyr)
library(ggplot2)
library(scales)
</code></pre>"><span class="hljs-comment"># load packages to read, write and process data, and to work with dates</span>
<span class="hljs-keyword">library</span>(readr)
<span class="hljs-keyword">library</span>(dplyr)
<span class="hljs-keyword">library</span>(ggplot2)
<span class="hljs-keyword">library</span>(scales)
</code></pre><p>We worked with <strong>readr</strong> and <strong>dplyr</strong> last week. <strong><a href="http://ggplot2.tidyverse.org/">ggplot2</a></strong> is a package for making charts that is also part of the tidyverse; <strong><a href="https://cran.r-project.org/web/packages/scales/scales.pdf">scales</a></strong> is a package that allows numbers to displayed in formats including currency in dollars, with commas separating thousands, and so on.</p><h3 id="work-with-the-opioid-prescriptions-data"><a name="work-with-the-opioid-prescriptions-data" href="#work-with-the-opioid-prescriptions-data"></a>Work with the opioid prescriptions data</h3><p>Load and view the data:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># load opioid prescription data
ca_opioids &amp;lt;- read_csv(&quot;ca_medicare_opioids.csv&quot;)

# look at the data
View(ca_opioids)
</code></pre>"><span class="hljs-comment"># load opioid prescription data</span>
ca_opioids &lt;- read_csv(<span class="hljs-string">"ca_medicare_opioids.csv"</span>)

<span class="hljs-comment"># look at the data</span>
View(ca_opioids)
</code></pre><h4 id="which-doctors-wrote-the-most-prescriptions-for-fentanyl-in-2015?"><a name="which-doctors-wrote-the-most-prescriptions-for-fentanyl-in-2015?" href="#which-doctors-wrote-the-most-prescriptions-for-fentanyl-in-2015?"></a>Which doctors wrote the most prescriptions for fentanyl in 2015?</h4><p>Fentanyl is a particularly controversial opioid, because of its strength: It’s about <a href="https://en.wikipedia.org/wiki/Fentanyl">75 times more powerful</a> than morphine. That means it can <a href="https://www.buzzfeed.com/danvergano/fentanyl-leading-overdoses">easily cause fatal overdoses</a> — although these mostly happen from illegaly purchased fentanyl.</p><p>From the final part of the assignment from last week, you should have seen that there are three variants of fentanyl in the <code>generic_name</code> data: <code>FENTANYL</code>, <code>FENTANYL CITRATE</code> and <code>FENTANYL CITRATE/PF</code>. So if we are to answer this question, we need to filter the data to include all of these drugs, and then add up the prescriptions for each doctor.</p><p>This is one way to do this:</p><pre class="r hljs"><code class="r" data-origin="<pre><code class=&quot;r&quot;># who wrote the most prescriptions for fentanyl in 2015?
fentanyl_2015 &amp;lt;- ca_opioids %&amp;gt;%
  filter(year == 2015
         &amp;amp; (generic_name == &quot;FENTANYL&quot; | generic_name == &quot;FENTANYL CITRATE&quot; | generic_name == &quot;FENTANYL CITRATE/PF&quot;)) %&amp;gt;%
  group_by(npi,
         nppes_provider_last_org_name,
         nppes_provider_first_name,
         nppes_provider_city,
         specialty_description) %&amp;gt;%
  summarize(prescriptions = sum(total_claim_count)) %&amp;gt;%
  arrange(desc(prescriptions))
</code></pre>"><span class="hljs-comment"># who wrote the most prescriptions for fentanyl in 2015?</span>
fentanyl_2015 &lt;- ca_opioids %&gt;%
  filter(year == <span class="hljs-number">2015</span>
         &amp; (generic_name == <span class="hljs-string">"FENTANYL"</span> | generic_name == <span class="hljs-string">"FENTANYL CITRATE"</span> | generic_name == <span class="hljs-string">"FENTANYL CITRATE/PF"</span>)) %&gt;%
  group_by(npi,
         nppes_provider_last_org_name,
         nppes_provider_first_name,
         nppes_provider_city,
         specialty_description) %&gt;%
  summarize(prescriptions = sum(total_claim_count)) %&gt;%
  arrange(desc(prescriptions))
</code></pre><p>There should be 5259 rows in the data, and the first few should look like this:</p><p><img src="img/class6_1.jpg" alt=""></p><p>The logic of this code should be starting to become familiar. Notice how the <code>OR</code> part of the filter, using <code>|</code>, is put into parentheses to run it first.</p><p>After the filter, we need to group by doctor, before summarizing the data. The unique identifying code for each healthcare provider is their National Provider Identifier, or <code>npi</code>. However, if we only group by this, the data returned won’t include any other information about each doctor. So the code above also groups by doctors’ names, locations, and specialties, so the data returned contains more information. This won’t change the grouping, because we are still grouping by individual healthcare provider.</p><p>In the <code>summarize</code> function, we need to add the numbers for <code>total_claim_count</code> for each provider, using the function <code>sum</code>, to get the total number of prescriptions written by each one for all the variants of fentanyl.</p><p>Here is another, more concise way to obtain the same result:</p><pre class="r hljs"><code class="r" data-origin="<pre><code class=&quot;r&quot;># who wrote the most prescriptions for fentanyl in 2015?
fentanyl_2015 &amp;lt;- ca_opioids %&amp;gt;%
  filter(year == 2015
         &amp;amp; grepl(&quot;fentanyl&quot;, generic_name, ignore.case = TRUE)) %&amp;gt;%
  group_by(npi,
           nppes_provider_last_org_name,
           nppes_provider_first_name,
           nppes_provider_city,
           specialty_description) %&amp;gt;%
  summarize(prescriptions = sum(total_claim_count)) %&amp;gt;%
  arrange(desc(prescriptions))
</code></pre>"><span class="hljs-comment"># who wrote the most prescriptions for fentanyl in 2015?</span>
fentanyl_2015 &lt;- ca_opioids %&gt;%
  filter(year == <span class="hljs-number">2015</span>
         &amp; grepl(<span class="hljs-string">"fentanyl"</span>, generic_name, ignore.case = <span class="hljs-literal">TRUE</span>)) %&gt;%
  group_by(npi,
           nppes_provider_last_org_name,
           nppes_provider_first_name,
           nppes_provider_city,
           specialty_description) %&gt;%
  summarize(prescriptions = sum(total_claim_count)) %&gt;%
  arrange(desc(prescriptions))
</code></pre><p>This demonstrates some simple pattern matching on text, using the function <code>grepl("pattern_a|pattern_b", x)</code>, which searches variable <code>x</code> for values containing any of a list of text values. Including <code>ignore.case = TRUE</code> means that matches are made irrespective of the case of any of the letters.</p><p><code>grepl</code> is useful for fuzzy text matching, when you want to find text entries that contain variations of the same word or phrase.</p><p>But notice that some of the top prescribers were not doctors, but physician assistants, nurse practitioners, or pharmacists. The following code also <strong>filters</strong> the data to remove data for these healthcare providers:</p><pre class="r hljs"><code class="r" data-origin="<pre><code class=&quot;r&quot;># which doctors wrote the most prescriptions for fentanyl in 2015?
fentanyl_2015_doctors &amp;lt;- ca_opioids %&amp;gt;%
  filter(year == 2015
         &amp;amp; grepl(&quot;fentanyl&quot;, generic_name, ignore.case = TRUE)
         &amp;amp; !grepl(&quot;assistant|practitioner|pharmacist&quot;, specialty_description, ignore.case = TRUE)) %&amp;gt;%
  group_by(npi,
           nppes_provider_last_org_name,
           nppes_provider_first_name,
           nppes_provider_city,
           specialty_description) %&amp;gt;%
  summarize(prescriptions = sum(total_claim_count)) %&amp;gt;%
  arrange(desc(prescriptions))
</code></pre>"><span class="hljs-comment"># which doctors wrote the most prescriptions for fentanyl in 2015?</span>
fentanyl_2015_doctors &lt;- ca_opioids %&gt;%
  filter(year == <span class="hljs-number">2015</span>
         &amp; grepl(<span class="hljs-string">"fentanyl"</span>, generic_name, ignore.case = <span class="hljs-literal">TRUE</span>)
         &amp; !grepl(<span class="hljs-string">"assistant|practitioner|pharmacist"</span>, specialty_description, ignore.case = <span class="hljs-literal">TRUE</span>)) %&gt;%
  group_by(npi,
           nppes_provider_last_org_name,
           nppes_provider_first_name,
           nppes_provider_city,
           specialty_description) %&gt;%
  summarize(prescriptions = sum(total_claim_count)) %&gt;%
  arrange(desc(prescriptions))
</code></pre><p>The new part of the <strong>filter</strong> function uses <code>!grepl</code> to search for text that does <em>not</em> match the pattern, and separates patterns to be searched with <code>|</code> for <code>OR</code>.</p><p>There whould be 4,600 rows in this data, and the first few rows should look like this:</p><p><img src="img/class6_2.jpg" alt=""></p><h4 id="calculate-the-total-number-of-fentanyl-prescriptions,-their-cost,-and-the-total-number-of-patients,-for-each-year"><a name="calculate-the-total-number-of-fentanyl-prescriptions,-their-cost,-and-the-total-number-of-patients,-for-each-year" href="#calculate-the-total-number-of-fentanyl-prescriptions,-their-cost,-and-the-total-number-of-patients,-for-each-year"></a>Calculate the total number of fentanyl prescriptions, their cost, and the total number of patients, for each year</h4><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># calculate the total number of fentanyl prescriptions, their cost, and the total number of patient/drug, for each year
fentanyl_year_summary &amp;lt;- ca_opioids %&amp;gt;%
  filter(grepl(&quot;fentanyl&quot;, generic_name, ignore.case = TRUE)) %&amp;gt;%
  group_by(year) %&amp;gt;%
  summarize(claims = sum(total_claim_count),
            cost = sum(total_drug_cost),
            patients = sum(bene_count))
</code></pre>"><span class="hljs-comment"># calculate the total number of fentanyl prescriptions, their cost, and the total number of patient/drug, for each year</span>
fentanyl_year_summary &lt;- ca_opioids %&gt;%
  filter(grepl(<span class="hljs-string">"fentanyl"</span>, generic_name, ignore.case = <span class="hljs-literal">TRUE</span>)) %&gt;%
  group_by(year) %&gt;%
  summarize(claims = sum(total_claim_count),
            cost = sum(total_drug_cost),
            patients = sum(bene_count))
</code></pre><p>This will be the result:</p><p><img src="img/class6_3.jpg" alt=""></p><p>Something has gone wrong: Instead of calculating the number of patients, the code has returned <code>NA</code>. This will happen when <strong>summarizing</strong> data if there are any missing, or <code>NA</code>, values. To solve the problem, use the following code, which includes <code>na.rm = TRUE</code>. This tells summary functions to remove <code>NA</code> values before running the calculation:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># calculate the total number of fentanyl prescriptions, their cost, and the total number of patient/drug, for each year
fentanyl_year_summary &amp;lt;- ca_opioids %&amp;gt;%
  filter(grepl(&quot;fentanyl&quot;, generic_name, ignore.case = TRUE)) %&amp;gt;%
  group_by(year) %&amp;gt;%
  summarize(claims = sum(total_claim_count),
            cost = sum(total_drug_cost),
            patients = sum(bene_count, na.rm = TRUE))
</code></pre>"><span class="hljs-comment"># calculate the total number of fentanyl prescriptions, their cost, and the total number of patient/drug, for each year</span>
fentanyl_year_summary &lt;- ca_opioids %&gt;%
  filter(grepl(<span class="hljs-string">"fentanyl"</span>, generic_name, ignore.case = <span class="hljs-literal">TRUE</span>)) %&gt;%
  group_by(year) %&gt;%
  summarize(claims = sum(total_claim_count),
            cost = sum(total_drug_cost),
            patients = sum(bene_count, na.rm = <span class="hljs-literal">TRUE</span>))
</code></pre><p><img src="img/class6_4.jpg" alt=""></p><p>Now we have data showing a number of patients prescribed fentanyl each year. However, we should treat this number with caution. The description of the data above explains that <code>NA</code> values are introduced wherever a doctor prescribed fentanyl to fewer than 11 patients. So each <code>NA</code> represents between 1 and 10 patients.</p><p>How many patients could be missing from the data each year?</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># how many patients might be missing from the data?
fentanyl_year_missing &amp;lt;- ca_opioids %&amp;gt;%
  filter(grepl(&quot;fentanyl&quot;, generic_name, ignore.case = TRUE)
         &amp;amp; is.na(bene_count)) %&amp;gt;%
  group_by(year) %&amp;gt;%
  summarize(max_missing_patients = n()*10)
</code></pre>"><span class="hljs-comment"># how many patients might be missing from the data?</span>
fentanyl_year_missing &lt;- ca_opioids %&gt;%
  filter(grepl(<span class="hljs-string">"fentanyl"</span>, generic_name, ignore.case = <span class="hljs-literal">TRUE</span>)
         &amp; is.na(bene_count)) %&gt;%
  group_by(year) %&gt;%
  summarize(max_missing_patients = n()*<span class="hljs-number">10</span>)
</code></pre><p>This should be the result:</p><p><img src="img/class6_5.jpg" alt=""></p><p>That’s a lot of potentially missing patients — more than we added up from the available data. We should abandon the idea of analyzing the number of patients.</p><p>In this code we used <code>is.na(bene_count)</code> to <strong>filter</strong> for only the missing values, then <strong>grouped</strong> by year, <strong>summarized</strong> by counting the number of records and multiplied by 10, because each missing value could represent up to 10 patients.</p><h4 id="create-a-summary,-showing-the-number-of-opioid-prescriptions-written-by-each-doctor,-the-total-cost-of-the-opioids-prescribed,-and-the-cost-per-claim"><a name="create-a-summary,-showing-the-number-of-opioid-prescriptions-written-by-each-doctor,-the-total-cost-of-the-opioids-prescribed,-and-the-cost-per-claim" href="#create-a-summary,-showing-the-number-of-opioid-prescriptions-written-by-each-doctor,-the-total-cost-of-the-opioids-prescribed,-and-the-cost-per-claim"></a>Create a summary, showing the number of opioid prescriptions written by each doctor, the total cost of the opioids prescribed, and the cost per claim</h4><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># Create a summary, showing the number of opioid prescriptions written by each doctor, the total cost of the opioids prescribed, and the cost per claim
doctor_summary &amp;lt;- ca_opioids %&amp;gt;%
  filter(!grepl(&quot;assistant|nurse|pharmacist&quot;, specialty_description, ignore.case = TRUE)) %&amp;gt;%
  group_by(npi,
           nppes_provider_last_org_name,
           nppes_provider_first_name,
           nppes_provider_city,
           specialty_description) %&amp;gt;%
  summarize(prescriptions = sum(total_claim_count),
            cost = sum(total_drug_cost)) %&amp;gt;%
  mutate(cost_per_prescription = cost/prescriptions) %&amp;gt;%
  arrange(desc(prescriptions))
</code></pre>"><span class="hljs-comment"># Create a summary, showing the number of opioid prescriptions written by each doctor, the total cost of the opioids prescribed, and the cost per claim</span>
doctor_summary &lt;- ca_opioids %&gt;%
  filter(!grepl(<span class="hljs-string">"assistant|nurse|pharmacist"</span>, specialty_description, ignore.case = <span class="hljs-literal">TRUE</span>)) %&gt;%
  group_by(npi,
           nppes_provider_last_org_name,
           nppes_provider_first_name,
           nppes_provider_city,
           specialty_description) %&gt;%
  summarize(prescriptions = sum(total_claim_count),
            cost = sum(total_drug_cost)) %&gt;%
  mutate(cost_per_prescription = cost/prescriptions) %&gt;%
  arrange(desc(prescriptions))
</code></pre><p>In this code, the <strong>filter</strong> removes the physician assistants, nurse practitioners, and pharmacists. Then we <strong>group</strong> by doctor, returning the same identifying information as in earlier examples, before <strong>summarizing</strong> by adding the number of prescriptions written, and the total cost of the drugs, across the entire three-year time period in the data. Then we use <code>mutate</code> to create a new column giving the cost per prescription for each doctor. Finally we <strong>sort</strong> in descending order of the total number of prescriptions written.</p><p>There should be 49,277 rows in the data, and the top few should look like this:</p><p><img src="img/class6_6.jpg" alt=""></p><h3 id="draw-some-charts-from-this-summary-data"><a name="draw-some-charts-from-this-summary-data" href="#draw-some-charts-from-this-summary-data"></a>Draw some charts from this summary data</h3><p>While running data analyses, it’s often useful to create charts to look at summaries of the data. Particularly useful are histograms, to examine a distribution, and scatterplots, to see how one variable varies with another.</p><p>To make simple charts, we will use <strong>ggplot2</strong>.</p><h4 id="introducing-ggplot2-and-the-grammar-of-graphics"><a name="introducing-ggplot2-and-the-grammar-of-graphics" href="#introducing-ggplot2-and-the-grammar-of-graphics"></a>Introducing ggplot2 and the grammar of graphics</h4><p>The “gg” in <strong>ggplot2</strong> stands for “<a href="http://www.amazon.com/The-Grammar-Graphics-Statistics-Computing/dp/0387245448">grammar of graphics</a>,” an approach to drawing charts devised by the statistician Leland Wilkinson. Rather than thinking in terms of finished charts like a scatter plot or a column chart, it starts by defining the coordinate system (usually the X and Y axes), maps data onto those coordinates, and then adds layers such as points, bars and so on. This is the logic behind ggplot2 code.</p><p>Some key things to understand about <strong>ggplot2</strong>:</p><ul>
<li><code>ggplot</code> This is the master function that creates a <strong>ggplot2</strong> chart.</li><li><code>aes</code> This function, named for “aesthetic mapping,” is used whenever data values are mapped onto a chart. So it is used when you define which variables are plotted onto the X and Y axes, and also if you want to change the size or color of parts of the chart according to values for a variable.</li><li><code>geom</code> All of the functions that add layers to a chart start with <code>geom</code>, followed by an underscore, for example <code>geom_point</code> or <code>geom_bar</code>. The code in the parentheses for any <code>geom</code> layer styles the items in that layer, and can include <code>aes</code> mappings of values from data.</li><li><code>theme</code> This function modifies the appearance of elements of a plot, used, for example, to set size and font face for text, the position of a legend, and so on.</li><li><code>scale</code> Functions that begin with <code>scale</code>, followed by an underscore, are used to modify the way an <code>aes</code> mapping of data appears on a chart. They can change the axis range, for example, or specify a color palette to be used to encode values in the data.</li><li><code>+</code> is used each time you add a layer, a scale, a theme, or elements like axis labels and a title. After a <code>+</code> you can continue on the same line of code or move the next line. I usually write a new line after each <code>+</code>, which makes the code easier to follow.</li></ul><h4 id="make-a-histogram-of-the-prescriptions-data"><a name="make-a-histogram-of-the-prescriptions-data" href="#make-a-histogram-of-the-prescriptions-data"></a>Make a histogram of the prescriptions data</h4><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># histogram of the costs data
ggplot(doctor_summary, aes(x = prescriptions)) +
  geom_histogram()
</code></pre>"><span class="hljs-comment"># histogram of the costs data</span>
ggplot(doctor_summary, aes(x = prescriptions)) +
  geom_histogram()
</code></pre><p>This code first noted that the <code>doctor_summary</code> data would be used for the chart in the <code>ggplot</code> function, then specificies that values for the number of prescriptions should be mapped to the X, or horizontal axis. We didn’t need to specify a variable for the Y axis for a histogram, because that is automatically a count of the number of records (here the number of doctors) in each bin.</p><p>This should be the result:</p><p><img src="img/class6_7.png" alt=""></p><p>The following code customizes the width of the bins, to 50 prescriptions, changes the X axis range between 0 and 3,000, and uses <code>labels</code> from the <strong>scales</strong> package to plot numbers with comma separators for thousands. <code>theme_minimal</code> is one of the built-in themes in <strong>ggplot2</strong>, which gives a basic chart with grid lines on a white background.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;>ggplot(doctor_summary, aes(x = prescriptions)) +
  geom_histogram(binwidth = 50) +
  theme_minimal() +
  scale_x_continuous(limits = c(0,3000),
                     labels = comma) +
  scale_y_continuous(labels = comma)
</code></pre>">ggplot(doctor_summary, aes(x = prescriptions)) +
  geom_histogram(binwidth = <span class="hljs-number">50</span>) +
  theme_minimal() +
  scale_x_continuous(limits = c(<span class="hljs-number">0</span>,<span class="hljs-number">3000</span>),
                     labels = comma) +
  scale_y_continuous(labels = comma)
</code></pre><p><img src="img/class6_8.png" alt=""></p><p>This is a very skewed distribution. Viewing this, we would conclude that the mean would not be a good summary statistic for this data; if we want to compare any doctor’s prescriptions of opioids to that for a “typical” doctor, it would be better to compare to the median number of prescriptions.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># calculate the mean and median number of opioid prescriptions written by CA doctors from 2013 to 2015
mean_median &amp;lt;- doctor_summary %&amp;gt;%
  ungroup() %&amp;gt;%
  summarize(mean_prescriptions = mean(prescriptions),
            median_prescriptions = median(prescriptions))
</code></pre>"><span class="hljs-comment"># calculate the mean and median number of opioid prescriptions written by CA doctors from 2013 to 2015</span>
mean_median &lt;- doctor_summary %&gt;%
  ungroup() %&gt;%
  summarize(mean_prescriptions = mean(prescriptions),
            median_prescriptions = median(prescriptions))
</code></pre><p>This should be the result:</p><p><img src="img/class6_9.jpg" alt=""></p><p>In the code above, we needed to <code>ungroup</code> before <strong>summarizing</strong>, otherwise the data would still be grouped by doctor.</p><h4 id="make-a-scatterplot-of-prescriptions-and-costs-data"><a name="make-a-scatterplot-of-prescriptions-and-costs-data" href="#make-a-scatterplot-of-prescriptions-and-costs-data"></a>Make a scatterplot of prescriptions and costs data</h4><p>Scatterplots are good for seeing how one variable relates to one another, and also for spotting outliers in data. Here we would expect the total cost of the drugs prescribed to increase with the total number of prescriptions. A scatterplot allows us to see whether all the doctors are closely clustered around the trend line, or whether there are some interesting outliers.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;>#### Make a scatterplot of prescriptions and costs data
ggplot(doctor_summary, aes(x = prescriptions, y = cost)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = lm) +
  theme_minimal() +
  scale_x_continuous(labels = comma) +
  scale_y_continuous(labels = dollar)
</code></pre>"><span class="hljs-comment">#### Make a scatterplot of prescriptions and costs data</span>
ggplot(doctor_summary, aes(x = prescriptions, y = cost)) +
  geom_point(alpha = <span class="hljs-number">0.3</span>) +
  geom_smooth(method = lm) +
  theme_minimal() +
  scale_x_continuous(labels = comma) +
  scale_y_continuous(labels = dollar)
</code></pre><p>In this code, we mapped the number of <code>prescriptions</code> to the X axis and their total <code>cost</code> to the Y or vertical axis. We then used <code>geom_point</code> to add the points, and made them partially transparent using <code>alpha = 0.3</code> (0 would be completely transparent; 1 would be completely opaque). <code>geom_smooth</code> added a trend line through the data; <code>method = lm</code> ensured that this is fitted with a “linear model,” giving a straight line. <code>labels = dollar</code> formatted the Y axis so the numbers were shown in dollars.</p><p>This should be the result:</p><p><img src="img/class6_10.png" alt=""></p><p>We can look sort the data in <code>View</code> to take a look at the doctors with unusually large costs per prescriptions:</p><p><img src="img/class6_11.jpg" alt=""></p><p>Remember the words of caution from the previous class: There may be some story leads here, but we would have to find out more about each doctor’s practise and patients to determine whether their high costs per prescription are justified.</p><p>We have only scratched the surface of what is possible with <strong>ggplot2</strong>: Its capabilities are covered at length in <strong>J221: Introduction to Data Visualization</strong>.</p><p>See the links in Further Reading for reference on <strong>ggplot2</strong> code.</p><h3 id="join-data-to-find-doctors-who-prescribed-opioids-who-have-also-been-subject-to-disciplinary-actions."><a name="join-data-to-find-doctors-who-prescribed-opioids-who-have-also-been-subject-to-disciplinary-actions." href="#join-data-to-find-doctors-who-prescribed-opioids-who-have-also-been-subject-to-disciplinary-actions."></a>Join data to find doctors who prescribed opioids who have also been subject to disciplinary actions.</h3><p>There are a number of <strong>join</strong> functions in <strong>dplyr</strong> to combine data from two data frames. Here are the most useful:</p><ul>
<li><code>inner_join()</code> returns values from both tables only where there is a match.</li><li><code>left_join()</code> returns all the values from the first-mentioned table, plus those from the second table that match.</li><li><code>semi_join()</code> filters the first-mentioned table to include only values that have matches in the second table.</li><li><code>anti_join()</code> filters the first-mentioned table to include only values that have no matches in the second table.</li></ul><p><a href="http://stat545-ubc.github.io/bit001_dplyr-cheatsheet.html">Here is a useful reference</a> for managing joins with <strong>dplyr</strong>.</p><p>We will join the <code>doctor_summary</code> data to the disciplinary action data to see which of the doctors prescribing opioids have been in trouble with the Medical Board of California. The unique identifier in the prescriber data is their National Provider Identifier, whereas the unique identifier in the disciplinary data are the doctors’ California medical license numbers. So we also need to load the file <code>npi_license.csv</code>, which relates these two identifiers to one another.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># load data
ca_discipline &amp;lt;- read_csv(&quot;ca_discipline.csv&quot;)

npi_license &amp;lt;- read_csv(&quot;npi_license.csv&quot;)
</code></pre>"><span class="hljs-comment"># load data</span>
ca_discipline &lt;- read_csv(<span class="hljs-string">"ca_discipline.csv"</span>)

npi_license &lt;- read_csv(<span class="hljs-string">"npi_license.csv"</span>)
</code></pre><p>First we will join these two files to one another:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># join those two data frames
ca_discipline_npi &amp;lt;- left_join(ca_discipline, npi_license)
</code></pre>"><span class="hljs-comment"># join those two data frames</span>
ca_discipline_npi &lt;- left_join(ca_discipline, npi_license)
</code></pre><p>By default, <strong>dplyr</strong> will join by any variables with matching names, but you can also specify the variables on which to join. So this will achieve the same result:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># join those two data frames
ca_discipline_npi &amp;lt;- left_join(ca_discipline, npi_license, by = &quot;license&quot;)
</code></pre>"><span class="hljs-comment"># join those two data frames</span>
ca_discipline_npi &lt;- left_join(ca_discipline, npi_license, by = <span class="hljs-string">"license"</span>)
</code></pre><p>If we <code>View</code> the result, the first few rows reveal some of the limitations of the <code>npi_license</code> data. Some of the doctors have not been joined to an <code>npi</code> code, while others appear to have more than one <code>npi</code> code (this is why there are 9,680 rows in the joined data, and only 7,651 in the <code>ca_discipline</code> data).</p><p><img src="img/class6_12.jpg" alt=""></p><p>Having made this join, we can now join to the <code>doctors_summary</code> data:</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># join disciplinary action data to the opioid prescription data
doctor_summary_actions &amp;lt;- inner_join(doctor_summary, ca_discipline_npi, by = &quot;npi&quot;) %&amp;gt;%
  arrange(desc(prescriptions))
</code></pre>"><span class="hljs-comment"># join disciplinary action data to the opioid prescription data</span>
doctor_summary_actions &lt;- inner_join(doctor_summary, ca_discipline_npi, by = <span class="hljs-string">"npi"</span>) %&gt;%
  arrange(desc(prescriptions))
</code></pre><p>Here are the first few rows in the data:</p><p><img src="img/class6_13.jpg" alt=""></p><p>Individual doctors may appear multiple times in the data if they have more than one disciplinary action on their file, because a join will be made to each individual action.</p><p>We can search for the disciplinary records and look at public documents at <a href="https://www.breeze.ca.gov/">this site</a>.</p><p>The second doctor on our list, Naga Thota, surrendered his California medical license on March 22, 2017. <a href="http://www2.mbc.ca.gov/BreezePDL/document.aspx?path=%5cDIDOCS%5c20170315%5cDMRAAAFC8%5c&amp;did=AAAFC170315180454982.DID">This public document</a> reveals that he was charged with prescribing excessive quantities of opioids to an addicted patient with whom he also engaged in a sexual relationship. In addition to disciplinary action from the Medical Board of California, he faced a criminal investigation by the federal Drug Enforcement Adminstration. In March 2017 <a href="http://www.sandiegouniontribune.com/news/courts/sd-me-thota-sentencing-20170306-story.html">sentenced to two years</a>, he was sentenced to two years in a federal prison.</p><p>The prescriptions data reveal that, prior to his convection and the loss of his medical license, Thota was also one of the largest prescribers of opioids in the state of California.</p><p>There are likely to be other story leads from this join, which you could follow up through public records and other reporting.</p><p>We’ve already seen that the <code>npi_license</code> data has some limitations. Another (less reliable) way to join the data would be by using the doctors’ first names, last names, and cities. First, however, we need to convert those variables in the <code>ca_discipline_npi</code> data to upper case, so they match the format of the <code>ca_opioids</code> data.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># change case of variables to be used in the join
ca_discipline_npi &amp;lt;- ca_discipline_npi %&amp;gt;%
  mutate(last_name = toupper(last_name),
         first_name = toupper(first_name),
         city = toupper(city))

# join disciplinary action data to the opioid prescription data
doctor_summary_actions_2 &amp;lt;- inner_join(doctor_summary, ca_discipline_npi, by = c(&quot;nppes_provider_last_org_name&quot; = &quot;last_name&quot;, 
                                                                                 &quot;nppes_provider_first_name&quot; = &quot;first_name&quot;,
                                                                                 &quot;nppes_provider_city&quot; = &quot;city&quot;)) %&amp;gt;%
  arrange(desc(prescriptions))
</code></pre>"><span class="hljs-comment"># change case of variables to be used in the join</span>
ca_discipline_npi &lt;- ca_discipline_npi %&gt;%
  mutate(last_name = toupper(last_name),
         first_name = toupper(first_name),
         city = toupper(city))

<span class="hljs-comment"># join disciplinary action data to the opioid prescription data</span>
doctor_summary_actions_2 &lt;- inner_join(doctor_summary, ca_discipline_npi, by = c(<span class="hljs-string">"nppes_provider_last_org_name"</span> = <span class="hljs-string">"last_name"</span>, 
                                                                                 <span class="hljs-string">"nppes_provider_first_name"</span> = <span class="hljs-string">"first_name"</span>,
                                                                                 <span class="hljs-string">"nppes_provider_city"</span> = <span class="hljs-string">"city"</span>)) %&gt;%
  arrange(desc(prescriptions))
</code></pre><p>Notice how the code is written to define the variables to be used for a custom join.</p><p>Now we can use an <code>anti_join</code> to see if this join picked up any doctors who were missing from the first.</p><pre class="r hljs"><code class="R" data-origin="<pre><code class=&quot;R&quot;># join disciplinary action data to the opioid prescription data
doctors_summary_actions_extra &amp;lt;- anti_join(doctor_summary_actions_2, doctor_summary_actions)
</code></pre>"><span class="hljs-comment"># join disciplinary action data to the opioid prescription data</span>
doctors_summary_actions_extra &lt;- anti_join(doctor_summary_actions_2, doctor_summary_actions)
</code></pre><p>Here are the first few rows in that data:</p><p><img src="img/class6_14.jpg" alt=""></p><p>Whenever making an join in this way, it crucial to verify through independent reporting that the individuals matched are the same person. For example, there are several doctors called Peter Lee in Los Angeles. The one with the disciplinary record is <a href="https://search.dca.ca.gov/details/8002/G/84673/aebacf63f2746d6ce6ac729ebbbe54f5">Peter Geon Lee</a>, a plastic surgeon. This is not <a href="https://search.dca.ca.gov/details/8002/A/47846/e516806f7ff2db771d5b14b7d175c755">Peter Chong Lee</a>, the physical medicine and rehabilitation specialist, with the NPI of <code>1063508786</code>, listed in the <code>ca_opioids</code> data. There may well be other false matches in the data.</p><h3 id="further-reading"><a name="further-reading" href="#further-reading"></a>Further reading</h3><p><strong><a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html">Introduction to dplyr</a></strong></p><p><strong><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">RStudio Data Wrangling Cheet Sheet</a></strong><br>Also introduces the <a href="https://blog.rstudio.org/2014/07/22/introducing-tidyr/">tidyr</a> package, which can manage wide-to-long transformations, and text-to-columns splits, among other data manipulations.</p><p><a href="http://www.amazon.com/R-Graphics-Cookbook-Winston-Chang/dp/1449316956"><strong><em>R Graphics Cookbook</em></strong></a> by Winston Chang<br>(Chang also has <a href="http://www.cookbook-r.com/">a helpful website</a> with much of the same information, available for free.)</p><p><a href="https://www.rstudio.com/wp-content/uploads/2015/08/ggplot2-cheatsheet.pdf"><strong>RStudio ggplot2 Cheat Sheet</strong></a></p><p><a href="http://ggplot2.tidyverse.org/reference/"><strong>ggplot2 documentation</strong></a></p><p><strong><a href="http://stackoverflow.com/">Stack Overflow</a></strong><br>For any work involving code, this question-and-answer site is a great resource for when you get stuck, to see how others have solved similar problems. Search the site, or <a href="http://stackoverflow.com/questions/tagged/r">browse R questions</a></p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
